<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AR Image with Pinch-to-Zoom and Vertical Drag</title> <!-- Title updated -->

    <!-- A-Frame Library -->
    <script src=https://aframe.io/releases/1.2.0/aframe.min.js></script>

    <!-- AR.js Library for Web AR -->
    <script src=https://cdn.rawgit.com/jeromeetienne/AR.js/1.7.5/aframe/build/aframe-ar.min.js></script>

    <!-- Hammer.js Library for Gesture Recognition -->
    <script src=https://hammerjs.github.io/dist/hammer.min.js></script>
</head>

<body style="margin: 0; overflow: hidden;">

    <!-- AR Scene -->
    <a-scene embedded arjs>
        <!-- 2D Image to Display in AR -->
        <!-- Storing initial position slightly differently for easier access -->
        <a-image id="resizableImage" src="output_visualization.svg" position="0 1.5 -3" width="4" height="3"></a-image>
    </a-scene>

    <!-- File Input for User to Upload an Image -->
    <div style="position: fixed; top: 10px; left: 10px;">
        <input type="file" id="imageUpload" accept="image/*" />
    </div>

    <!-- Script for Handling Gestures and Image Upload -->
    <script>
        // Get the image element in the AR scene
        var image = document.getElementById('resizableImage');

        // --- Variables for tracking state ---
        var currentScale = { x: 1, y: 1, z: 1 }; // Store current scale factors
        var currentPosition = image.getAttribute('position'); // Get initial position
        var initialY = 0;        // To store Y position at the start of a pan
        var panSensitivity = 0.01; // Adjust this for drag speed (pixels to world units)

        // Initialize Hammer.js on the entire document body
        var mc = new Hammer(document.body);

        // --- Configure Gestures ---
        // Enable pinch gesture recognition
        mc.get('pinch').set({ enable: true });

        // Enable pan gesture recognition, specifically for vertical movement
        mc.get('pan').set({ enable: true, direction: Hammer.DIRECTION_VERTICAL });

        // Allow pinch and pan recognizers to work together if needed
        // This helps Hammer.js decide which gesture is active
        mc.get('pinch').recognizeWith(mc.get('pan'));

        // --- Event Listeners ---

        // Pinch event listener to scale the image
        mc.on('pinch', function (ev) {
            // Update scale based on pinch gesture - applying Hammer's scale directly
            let scaleValue = ev.scale; // Use Hammer's scale reading relative to pinch start

            // Store and apply the new scale (keep Z scale at 1)
            currentScale.x = scaleValue;
            currentScale.y = scaleValue;
            image.setAttribute('scale', `${currentScale.x} ${currentScale.y} 1`);
        });

        // Pan start listener - records the starting Y position
        mc.on('panstart', function(ev) {
            // Get the position *when the pan starts*
            currentPosition = image.getAttribute('position');
            initialY = currentPosition.y;
        });

        // Pan move listener - handles the vertical dragging
        mc.on('panmove', function (ev) {
            // ev.deltaY is the change in pixels since panstart
            // Calculate the new Y position based on initial position and drag amount
            let newY = initialY + (ev.deltaY * panSensitivity);

            // Update the tracked position
            currentPosition.y = newY;

            // Apply the new position (only changing Y)
            // Using setAttribute with individual components is safer
            image.setAttribute('position', {
                x: currentPosition.x,
                y: newY, // Use the calculated new Y
                z: currentPosition.z
            });
        });

        // Image upload functionality (no changes needed here)
        document.getElementById('imageUpload').addEventListener('change', function (event) {
            var file = event.target.files[0]; // Get the selected file
            if (file) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    // Set the image source to the uploaded image
                    image.setAttribute('src', e.target.result);
                };
                reader.readAsDataURL(file); // Read the file as a Data URL
            }
        });
    </script>
</body>
</html>
